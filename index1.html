<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhishGuard Lite — Email Safety Checker</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#06b6d4;
      --danger:#ef4444; --warn:#f59e0b; --safe:#10b981;
    }
    body{
      margin:0; font-family:Inter,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#071126 0%, #0b1220 100%);
      color:#e6eef6; -webkit-font-smoothing:antialiased;
    }
    .container{max-width:980px;margin:36px auto;padding:20px;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:20px; box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    h1{margin:0 0 8px;font-size:1.8rem;}
    p.lead{color:var(--muted);margin-top:0;}
    textarea{width:100%;min-height:180px;border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.05);background:#051022;color:inherit;resize:vertical}
    input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:#051022;color:inherit}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    .btn{display:inline-block;padding:10px 16px;border-radius:8px;background:var(--accent);color:#042a2f;border:none;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .meter{height:18px;border-radius:9px;background:rgba(255,255,255,0.06);overflow:hidden;margin-top:10px}
    .meter > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#06b6d4,#10b981)}
    .tag{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted);margin:6px 6px 6px 0;font-size:0.9rem}
    .reasons{margin-top:12px}
    .danger{color:var(--danger);font-weight:700}
    .warn{color:var(--warn);font-weight:700}
    .safe{color:var(--safe);font-weight:700}
    footer{margin-top:18px;color:var(--muted);font-size:0.9rem}
    .sample-btn{background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
    @media(max-width:640px){ .row{flex-direction:column} h1{font-size:1.4rem} textarea{min-height:140px} }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>PhishGuard Lite — Email Safety Checker</h1>
      <p class="lead">Paste an email message (or full email text). The tool analyzes keywords, links, domain patterns, ALL CAPS shouting, and sender-name mismatch to produce a risk percentage and explanations.</p>

      <div style="margin-top:12px" class="row">
        <div class="col">
          <label style="font-weight:600;margin-bottom:6px;display:block">From (display name, optional)</label>
          <input id="displayName" placeholder='e.g., "John Doe (CEO)"' />
        </div>
        <div class="col">
          <label style="font-weight:600;margin-bottom:6px;display:block">From (email address, optional)</label>
          <input id="fromEmail" placeholder='e.g., john.doe@acme.com' />
        </div>
      </div>

      <div style="margin-top:12px">
        <label style="font-weight:600;display:block;margin-bottom:6px">Email message / body</label>
        <textarea id="message" placeholder="Paste the email body or full email (headers + body) here..."></textarea>
      </div>

      <div style="margin-top:12px" class="row">
        <button class="btn" id="analyzeBtn">Analyze</button>
        <button class="btn secondary" id="clearBtn">Clear</button>
        <button class="sample-btn" id="sampleSafe">Load Safe Sample</button>
        <button class="sample-btn" id="samplePhish">Load Phishing Sample</button>
        <button class="sample-btn" id="sampleBEC">Load BEC Sample</button>
      </div>

      <div style="margin-top:18px" id="resultCard" class="card" hidden>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 id="label" style="margin:0;font-size:1.1rem"></h2>
            <div style="color:var(--muted);margin-top:6px" id="scoreText"></div>
          </div>
          <div style="min-width:260px">
            <div class="meter"><i id="meterBar"></i></div>
            <div style="display:flex;justify-content:space-between;margin-top:6px;color:var(--muted);font-size:0.9rem">
              <div>0%</div><div>100%</div>
            </div>
          </div>
        </div>

        <div class="reasons" id="reasons"></div>
        <div style="margin-top:10px;color:var(--muted)" id="advice"></div>
      </div>

      <footer>Tip: This is a client-side prototype for demo purposes. For production-grade detection, connect to a backend ML model and use real email headers.</footer>
    </div>
  </div>

  <script>
    // --- configuration lists ---
    const KEYWORDS = ["urgent","immediately","asap","verify","verify your","password","suspend","suspended","click here","login now","payment","transfer","wire","invoice","pay now","account suspended","security alert","confirm","authorize","bank details","prize","congratulations","claim"];
    const MANIPULATION = ["ceo","manager","director","hr","finance","payroll","accountant","supervisor","legal","admin","helpdesk"];
    const SUSPICIOUS_TLDS = [".xyz",".top",".club",".online",".site",".win",".info",".ru",".cn",".tk"];
    const URL_REGEX = /https?:\/\/[^\s'"]+/ig;
    const IP_DOMAIN_REGEX = /https?:\/\/\d{1,3}(\.\d{1,3}){3}(:\d+)?/ig;
    
    const el = id => document.getElementById(id);

    // --- helper functions ---
    function findKeywords(text, list){
      const found = [];
      const lower = text.toLowerCase();
      list.forEach(k => { if(lower.includes(k)) found.push(k); });
      return found;
    }

    function findLinks(text){
      const links = text.match(URL_REGEX) || [];
      return links;
    }

    function isSuspiciousLink(link){
      try {
        const u = new URL(link);
        const domain = u.hostname.toLowerCase();
        // IP in hostname
        if(/^\d{1,3}(\.\d{1,3}){3}$/.test(domain)) return true;
        // long host (very long domains are suspicious)
        if(domain.length > 30) return true;
        // suspicious tlds
        for(const t of SUSPICIOUS_TLDS) if(domain.endsWith(t)) return true;
        // contains many dashes or weird chars
        if((domain.match(/-/g)||[]).length > 2) return true;
        return false;
      } catch(e){
        return false;
      }
    }

    function uppercaseRatio(text){
      const letters = (text.match(/[A-Za-z]/g)||[]).length;
      const upper = (text.match(/[A-Z]/g)||[]).length;
      return letters===0 ? 0 : upper/letters;
    }

    function countExclamations(text){
      return (text.match(/!/g)||[]).length;
    }

    function senderMismatch(displayName, fromEmail){
      if(!displayName || !fromEmail) return false;
      // simple check: does display name contain parts of local-part?
      const local = fromEmail.split("@")[0].toLowerCase();
      const nameParts = displayName.toLowerCase().replace(/[^\w\s]/g,'').split(/\s+/).filter(Boolean);
      if(nameParts.length===0) return false;
      // if none of nameParts appear in local, treat as mismatch
      const matches = nameParts.some(p => local.includes(p));
      return !matches;
    }

    function clamp100(v){ return Math.max(0, Math.min(100, Math.round(v))); }

    function analyzeAll(displayName, fromEmail, text){
      const reasons = [];
      const lower = text.toLowerCase();

      // keywords
      const kFound = findKeywords(lower, KEYWORDS);
      if(kFound.length) reasons.push({type:"keywords",text:`Matched risky words: ${kFound.slice(0,6).join(", ")}`});

      // manipulation (senior roles)
      const mFound = findKeywords(lower, MANIPULATION);
      if(mFound.length) reasons.push({type:"manipulation",text:`Impersonation cues: ${mFound.join(", ")}`});

      // links
      const links = findLinks(text);
      if(links.length) reasons.push({type:"links",text:`Found ${links.length} link(s).`});

      // suspicious links
      const suspiciousLinks = links.filter(isSuspiciousLink);
      if(suspiciousLinks.length) reasons.push({type:"suspiciousLinks",text:`Suspicious link(s) detected: ${suspiciousLinks.join(", ")}`});

      // IP links
      const ipLinks = (text.match(IP_DOMAIN_REGEX) || []);
      if(ipLinks.length) reasons.push({type:"ipLinks",text:`Link with IP address: ${ipLinks.join(", ")}`});

      // uppercase
      const uRatio = uppercaseRatio(text);
      if(uRatio > 0.35) reasons.push({type:"uppercase",text:`High uppercase ratio (${Math.round(uRatio*100)}%) — shouting/urgent.`});

      // exclamation marks
      const ex = countExclamations(text);
      if(ex >= 2) reasons.push({type:"exclamations",text:`Contains ${ex} exclamation mark(s)`});

      // sender mismatch
      const mismatch = senderMismatch(displayName, fromEmail);
      if(mismatch) reasons.push({type:"senderMismatch",text:`Display name doesn't match email local-part (possible spoofing).`});

      // score calculation (component-based)
      let score = 0;
      // keywords: each up to 5 matches => up to 40 points
      score += Math.min(kFound.length,5) * 8;
      // manipulation: up to 3 matches => up to 30
      score += Math.min(mFound.length,3) * 10;
      // links: each link 12 pts up to 30
      score += Math.min(links.length,3) * 12;
      // suspicious links: each 25 pts up to 50
      score += Math.min(suspiciousLinks.length,2) * 25;
      // IP links extra 25
      score += Math.min(ipLinks.length,1) * 25;
      // uppercase ratio
      if(uRatio > 0.6) score += 18;
      else if(uRatio > 0.35) score += 10;
      // exclamations
      if(ex >= 5) score += 12;
      else if(ex >= 2) score += 6;
      // sender mismatch
      if(mismatch) score += 22;

      // normalize and clamp
      const final = clamp100(score);
      return {
        score: final,
        reasons,
        kFound, mFound, links, suspiciousLinks, uRatio, ex, mismatch
      };
    }

    // --- UI wiring ---
    el('analyzeBtn').addEventListener('click', ()=>{
      const displayName = el('displayName').value.trim();
      const fromEmail = el('fromEmail').value.trim();
      const msg = el('message').value.trim();
      if(!msg){
        alert("Please paste an email message to analyze.");
        return;
      }
      const r = analyzeAll(displayName, fromEmail, msg);
      // update meter
      el('resultCard').hidden = false;
      el('meterBar').style.width = r.score + "%";
      // label
      let labelText = "Safe";
      let labelClass = "safe";
      if(r.score >= 70){ labelText = "Dangerous"; labelClass = "danger"; }
      else if(r.score >= 40){ labelText = "Suspicious"; labelClass = "warn"; }
      el('label').textContent = `${labelText}`;
      el('label').className = labelClass;
      el('scoreText').textContent = `Risk score: ${r.score}%`;
      // reasons list
      const reasonsEl = el('reasons');
      reasonsEl.innerHTML = "";
      if(r.reasons.length===0){
        reasonsEl.innerHTML = `<div class="tag">No suspicious indicators found</div>`;
      } else {
        r.reasons.forEach(rr => {
          const div = document.createElement('div');
          div.className = 'tag';
          div.textContent = rr.text;
          reasonsEl.appendChild(div);
        });
      }
      // advice
      let advice = "";
      if(r.score >= 70) advice = "❌ High risk — do NOT click links or reply. Verify sender via a separate channel (call). Report to security.";
      else if(r.score >= 40) advice = "⚠️ Possible phishing — be cautious. Check links by hovering, verify sender's email domain, do not provide passwords.";
      else advice = "✅ Looks low risk — still exercise normal caution (avoid clicking unknown links).";
      el('advice').textContent = advice;
    });

    el('clearBtn').addEventListener('click', ()=>{
      el('message').value = "";
      el('fromEmail').value = "";
      el('displayName').value = "";
      el('resultCard').hidden = true;
      el('meterBar').style.width = "0%";
    });

    // sample messages
    el('sampleSafe').addEventListener('click', ()=>{
      el('displayName').value = "Alice Johnson";
      el('fromEmail').value = "alice.johnson@acme.com";
      el('message').value = "Hi Nived,\n\nLet's meet tomorrow at 3 PM to go over the project details. Thanks!\n\nBest,\nAlice";
    });
    el('samplePhish').addEventListener('click', ()=>{
      el('displayName').value = "Support Team";
      el('fromEmail').value = "support@account-security.xyz";
      el('message').value = "URGENT: Your account has been suspended. Click here http://account-security.xyz/login to verify your password immediately!";
    });
    el('sampleBEC').addEventListener('click', ()=>{
      el('displayName').value = "CEO - Michael Clark";
      el('fromEmail').value = "m.clark@acme-payroll.com";
      el('message').value = "Hi,\n\nPlease transfer $25,000 to the following account today. It's urgent and confidential.\nAccount: 123456789\nBank: FakeBank\nRegards,\nMichael";
    });

    // initial demo (optional)
    // el('samplePhish').click();
  </script>
</body>
</html>
